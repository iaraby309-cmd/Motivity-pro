<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Motivity AI - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root{ --motivity-red:#e60012; --tech-blue:#38bdf8; --monitor-green:#22c55e; --bg:#0d1117; }
        *{box-sizing:border-box; font-family:'Cairo', sans-serif; margin:0; padding:0}
        body{background:var(--bg); color:#fff; display:flex; height:100vh; overflow:hidden}

        .sidebar{width:450px; background:#161b22; padding:20px; overflow-y:auto; border-left:4px solid var(--motivity-red); flex-shrink:0}
        .box{background:#21262d; padding:15px; border-radius:10px; margin-bottom:12px; border:1px solid #30363d}
        h3{font-size:13px; color:var(--tech-blue); border-bottom:1px solid #444; padding-bottom:5px; margin-bottom:10px; text-transform: uppercase;}
        label{font-size:11px; color:#8b949e; display:block; margin-top:8px}
        input, select{width:100%; padding:8px; background:#0d1117; color:#fff; border:1px solid #30363d; border-radius:6px; margin-top:4px}

        .main-view{flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000}
        canvas{background:#050505; border:2px solid #333; border-radius:12px; width:95%; max-height:75vh}

        .btn-group{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px}
        button{padding:12px; border:none; border-radius:8px; cursor:pointer; font-weight:700; transition:0.3s; font-size: 13px;}
        .btn-smart{background:var(--tech-blue); color:#000}
        .btn-report{background:var(--motivity-red); color:#fff}
        .btn-reset{background:#333; color:#ff4d4d; border:1px solid #444; grid-column: span 2;}

        #reportPage{display:none; position:fixed; inset:0; background:#fff; z-index:9999; color:#333; overflow-y:auto; padding:40px}
        .report-content{max-width:1000px; margin:auto; padding:30px; border:1px solid #ddd; background:#fff; text-align: right;}
        .reasoning-box{background:#f0f7ff; border-right:8px solid var(--motivity-red); padding:20px; margin:20px 0; line-height:1.7}
        
        .status-pass { color: var(--monitor-green); font-weight: bold; border-right: 5px solid var(--monitor-green); padding-right: 10px; }
        .status-fail { color: var(--motivity-red); font-weight: bold; border-right: 5px solid var(--motivity-red); padding-right: 10px; }

        table{width:100%; border-collapse:collapse; margin:20px 0}
        th, td{border:1px solid #ddd; padding:12px; text-align:right}
        th{background:#f4f4f4; font-weight:900}
        
        @media print { .no-print { display: none !important; } #reportPage { position: static; display: block; } }
    </style>
</head>
<body>

<div class="sidebar no-print">
    <h2 style="color:var(--motivity-red); text-align:center; margin-bottom:15px; font-weight:900;">MOTIVITY MASTER AI</h2>

    <div class="box">
        <h3>ğŸ“ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø¬Ù…Ù‡ÙˆØ±</h3>
        <div style="display:flex; gap:10px">
            <div><label>Ø·ÙˆÙ„ Ø§Ù„Ø³Ø§Ø­Ø© (Ù…)</label><input type="number" id="l" value="120" oninput="draw()"></div>
            <div><label>Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø§Ø­Ø© (Ù…)</label><input type="number" id="w" value="70" oninput="draw()"></div>
        </div>
        <div style="display:flex; gap:10px">
            <div><label>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø±Ø­ (Ù…)</label><input type="number" id="sw" value="25" oninput="draw()"></div>
            <div><label>Ø¹Ù…Ù‚ Ø§Ù„Ù…Ø³Ø±Ø­ (Ù…)</label><input type="number" id="sd" value="12" oninput="draw()"></div>
        </div>
        <label>Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</label>
        <input type="number" id="crowd" value="5000" oninput="draw()">
    </div>

    <div class="box">
        <h3>ğŸ”Š Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ù„ØµØ¨</h3>
        <label>Ù†Ø¸Ø§Ù… Ø§Ù„Ù€ Line Array</label>
        <select id="main_pa" onchange="draw()"></select>
        <input type="number" id="main_qty" value="16" oninput="draw()">

        <label>Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ¨-ÙˆÙˆÙØ±</label>
        <select id="sub_pa" onchange="draw()"></select>
        <input type="number" id="sub_qty" value="12" oninput="draw()">

        <label>ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµØ¨-ÙˆÙˆÙØ±</label>
        <select id="sub_pos" onchange="draw()">
            <option value="sides">ØªÙˆØ²ÙŠØ¹ Ø¬Ø§Ù†Ø¨ÙŠ (LR Stack)</option>
            <option value="front">ØªÙˆØ²ÙŠØ¹ Ø£Ù…Ø§Ù…ÙŠ (Electronic Arc)</option>
        </select>
    </div>

    <div class="box">
        <h3>ğŸ›°ï¸ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ù„Ø¡ ÙˆØ§Ù„ØªØ£Ø®ÙŠØ± (Fills)</h3>
        <label>Out-Fills (15m)</label>
        <select id="s1_pa" onchange="draw()"></select>
        <input type="number" id="s1_qty" value="4" oninput="draw()">

        <label>Side-Fills (40m)</label>
        <select id="s2_pa" onchange="draw()"></select>
        <input type="number" id="s2_qty" value="4" oninput="draw()">

        <label>Ø£Ø¨Ø±Ø§Ø¬ Ø§Ù„ØªØ£Ø®ÙŠØ± (65m+)</label>
        <select id="d_pa" onchange="draw()"></select>
        <input type="number" id="d_qty" value="6" oninput="draw()">
    </div>

    <div class="box">
        <h3>ğŸ›ï¸ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ§Ù„Ù…ÙˆÙ†ÙŠØªÙˆØ±</h3>
        <label>Ø³Ù…Ø§Ø¹Ø§Øª Ø§Ù„Ù…ÙˆÙ†ÙŠØªÙˆØ±</label>
        <select id="mon_pa" onchange="draw()"></select>
        <input type="number" id="mon_qty" value="8" oninput="draw()">

        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…ÙƒØ¨Ø±Ø§Øª (Amplifiers)</label>
        <select id="amp_unit"></select>

        <label>Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ù‚Ù…ÙŠ (DSP)</label>
        <select id="dsp_unit"></select>
    </div>

    <div class="btn-group">
        <button class="btn-smart" onclick="applySmart()">âœ¨ ØªØµÙ…ÙŠÙ… Ø°ÙƒÙŠ AI</button>
        <button class="btn-report" onclick="openReport()">ğŸ“„ ØªÙ‚Ø±ÙŠØ± BOQ Ø§Ù„ÙÙ†ÙŠ</button>
        <button class="btn-reset" onclick="location.reload()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>
</div>

<div class="main-view no-print">
    <canvas id="stageCanvas"></canvas>
    <div style="font-size:11px; color:#555; margin-top:10px;">
        ğŸ”µ Ø±Ø¦ÙŠØ³ÙŠ | âšª ØµØ¨ | ğŸŸ¢ Ù…ÙˆÙ†ÙŠØªÙˆØ± | ğŸŸ¡ Out-fill | ğŸŸ  Side-fill | ğŸŸ£ Delay
    </div>
</div>

<div id="reportPage">
    <div class="report-content">
        <div class="no-print" style="margin-bottom:20px;">
            <button onclick="document.getElementById('reportPage').style.display='none'">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­Ø±Ø±</button>
            <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± PDF</button>
        </div>
        <h1 style="color:var(--motivity-red); border-bottom:4px solid red; padding-bottom:10px">Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ - MOTIVITY AUDIO</h1>
        
        <div id="verdictBox" class="reasoning-box"></div>
        <div id="smartReasoning" class="reasoning-box"></div>
        
        <table id="boqTable"></table>
        <h3>Ù…Ø®Ø·Ø· Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµÙˆØªÙŠ (Stage View):</h3>
        <img id="reportImg" style="width:100%; border:1px solid #333; margin-top:10px;">
    </div>
</div>

<script>
    const CATALOG = {
        "MLA212": { rms: 900, spl: 134 }, "MLA210": { rms: 700, spl: 137 },
        "MLHP312D": { rms: 900, spl: 134 }, "M10-LA": { rms: 700, spl: 136 },
        "T-24": { rms: 800, spl: 136 }, "MTL-152": { rms: 600, spl: 128 },
        "MTL-700 3G": { rms: 500, spl: 124 },
        "DB-218 3G": { rms: 1400, spl: 136 }, "QX-218": { rms: 1400, spl: 135 },
        "MCC828SD": { rms: 1600, spl: 136 }, "B-30": { rms: 1200, spl: 135 }, "AT-18B": { rms: 800, spl: 130 },
        "DB-25 3G": { rms: 1000, spl: 133 }, "DB-25 NW": { rms: 1000, spl: 133 },
        "HD315A": { rms: 1000, spl: 133 }, "HD312A": { rms: 1000, spl: 131 },
        "AT-15": { rms: 500, spl: 127 }, "AT-12": { rms: 450, spl: 125 }, "AT-10": { rms: 350, spl: 123 },
        "DB-15M 3G": { rms: 500, spl: 124 },
        "MA-1500": { spec: "2x1500W @ 8Î©" }, "MA-1000": { spec: "2x1000W @ 8Î©" },
        "MA-800": { spec: "2x800W @ 8Î©" }, "D11.4": { spec: "4x1100W Digital" },
        "DP48": { spec: "4 In / 8 Out DSP" }
    };

    function fillSelectors() {
        const specs = {
            main_pa: ["MLA212", "MLA210", "MLHP312D", "M10-LA", "T-24"],
            sub_pa: ["DB-218 3G", "QX-218", "MCC828SD", "B-30", "AT-18B"],
            s1_pa: ["DB-25 3G", "DB-25 NW", "HD315A", "AT-15"],
            s2_pa: ["MTL-152", "MTL-700 3G", "HD312A", "AT-12"],
            d_pa: ["AT-12", "AT-10", "MTL-700 3G"],
            mon_pa: ["DB-15M 3G", "AT-12", "AT-10"],
            amp_unit: ["MA-1500", "MA-1000", "MA-800", "D11.4"],
            dsp_unit: ["DP48"]
        };
        for(let id in specs) {
            const el = document.getElementById(id);
            el.innerHTML = "";
            specs[id].forEach(m => el.add(new Option(m, m)));
        }
    }

    const canvas = document.getElementById('stageCanvas');
    const ctx = canvas.getContext('2d');

    function draw() {
        const L = parseFloat(document.getElementById('l').value) || 100;
        const W = parseFloat(document.getElementById('w').value) || 70;
        const sw = parseFloat(document.getElementById('sw').value) || 20;
        const sd = parseFloat(document.getElementById('sd').value) || 10;
        const monQty = parseInt(document.getElementById('mon_qty').value) || 0;
        const subPos = document.getElementById('sub_pos').value;
        const subQty = parseInt(document.getElementById('sub_qty').value) || 0;

        canvas.width = 1200; canvas.height = 800;
        const scale = Math.min(canvas.width/L, canvas.height/W) * 0.8;
        const oX = (canvas.width - L*scale)/2;
        const oY = (canvas.height - W*scale)/2;

        ctx.clearRect(0,0,1200,800);
        ctx.fillStyle = "#0a0a0a"; ctx.fillRect(oX, oY, L*scale, W*scale);

        const sW = sw * scale; const sD = sd * scale;
        const sX = oX + (L*scale - sW)/2;
        ctx.fillStyle = "#161b22"; ctx.fillRect(sX, oY, sW, sD);
        ctx.strokeStyle = "#e60012"; ctx.strokeRect(sX, oY, sW, sD);

        // Ù…ÙˆÙ†ÙŠØªÙˆØ± (Ø£Ø®Ø¶Ø±)
        ctx.fillStyle = "#22c55e";
        const mSpc = sW / (monQty + 1);
        for(let i=1; i<=monQty; i++) {
            ctx.beginPath(); ctx.moveTo(sX + i*mSpc - 8, oY + sD - 5);
            ctx.lineTo(sX + i*mSpc + 8, oY + sD - 5); ctx.lineTo(sX + i*mSpc, oY + sD - 18);
            ctx.fill();
        }

        // FOH (Ø£Ø²Ø±Ù‚)
        ctx.fillStyle = "#38bdf8"; ctx.fillRect(sX-30, oY, 20, 60); ctx.fillRect(sX+sW+10, oY, 20, 60);

        // ØµØ¨ (Ø£Ø¨ÙŠØ¶)
        ctx.fillStyle = "#fff";
        if(subPos === "sides") {
            for(let i=0; i<subQty/2; i++) { ctx.fillRect(sX-60, oY + i*20, 20, 15); ctx.fillRect(sX+sW+40, oY + i*20, 20, 15); }
        } else {
            const spc = sW / subQty; for(let i=0; i<subQty; i++) ctx.fillRect(sX + i*spc, oY+sD+5, 18, 12);
        }

        const dEx = (dist, qty, col) => {
            const py = oY + (dist * scale);
            ctx.fillStyle = col;
            for(let i=0; i<qty/2; i++) { ctx.fillRect(oX+15, py+i*25, 15, 15); ctx.fillRect(oX+L*scale-30, py+i*25, 15, 15); }
        };
        dEx(15, document.getElementById('s1_qty').value, "#facc15"); // Out-fills
        dEx(40, document.getElementById('s2_qty').value, "#f59e0b"); // Side-fills
        
        // Delay (Ø¨Ù†ÙØ³Ø¬ÙŠ)
        const dq = parseInt(document.getElementById('d_qty').value);
        ctx.fillStyle = "#a855f7";
        for(let i=1; i<=dq; i++) ctx.fillRect(oX + (L*scale/(dq+1))*i, oY+(65*scale), 15, 15);
    }

    function applySmart() {
        const cr = parseInt(document.getElementById('crowd').value) || 1000;
        document.getElementById('main_qty').value = Math.max(12, Math.ceil(cr / 400));
        document.getElementById('sub_qty').value = Math.max(8, Math.ceil(document.getElementById('main_qty').value * 0.8));
        draw();
    }

    function openReport() {
        const L = parseFloat(document.getElementById('l').value);
        const cr = parseInt(document.getElementById('crowd').value);
        const mq = document.getElementById('main_pa').value;
        const mqty = parseInt(document.getElementById('main_qty').value);
        const dq = parseInt(document.getElementById('d_qty').value);

        const baseSpl = CATALOG[mq].spl;
        const splAtBack = (baseSpl + (10 * Math.log10(mqty))) - (20 * Math.log10(L));

        let verdict = "";
        if(splAtBack < 96 && dq < 4) {
            verdict = `<h2 class="status-fail">âš ï¸ ØªØ­Ø°ÙŠØ± Ù‡Ù†Ø¯Ø³ÙŠ: ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ù†Ø®ÙØ¶Ø©</h2>
                      <p>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ ${L}Ù… Ù‡Ùˆ ${splAtBack.toFixed(1)}dB. ÙŠÙ†ØµØ­ Ø¨Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø³Ù…Ø§Ø¹Ø§Øª Ø§Ù„Ù€ Main Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø£Ø¨Ø±Ø§Ø¬ ØªØ£Ø®ÙŠØ± (Delay Towers).</p>`;
        } else {
            verdict = `<h2 class="status-pass">âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ØªÙ…Ø¯ Ù‡Ù†Ø¯Ø³ÙŠØ§Ù‹</h2>
                      <p>Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„ØµÙˆØªÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù€ ${cr} Ø´Ø®Øµ Ø¹Ù„Ù‰ Ø§Ù…ØªØ¯Ø§Ø¯ ${L} Ù…ØªØ±.</p>`;
        }
        document.getElementById('verdictBox').innerHTML = verdict;

        let totalRMS = 0;
        let html = "<tr><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª</th></tr>";
        const keys = [["Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ", "main_pa", "main_qty"], ["Ø§Ù„ØµØ¨-ÙˆÙˆÙØ±", "sub_pa", "sub_qty"], ["Out-Fills", "s1_pa", "s1_qty"], ["Side-Fills", "s2_pa", "s2_qty"], ["Ø£Ø¨Ø±Ø§Ø¬ Ø§Ù„ØªØ£Ø®ÙŠØ±", "d_pa", "d_qty"], ["Ø§Ù„Ù…ÙˆÙ†ÙŠØªÙˆØ±", "mon_pa", "mon_qty"]];
        
        keys.forEach(k => {
            const m = document.getElementById(k[1]).value;
            const q = parseInt(document.getElementById(k[2]).value);
            totalRMS += (CATALOG[m].rms * q);
            html += `<tr><td>${k[0]}</td><td>${m}</td><td>${q}</td><td>${CATALOG[m].rms}W RMS</td></tr>`;
        });

        document.getElementById('smartReasoning').innerHTML = `<h3>ğŸ“ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ù‚Ø¯Ø±Ø©:</h3>
            <p>â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <strong>${totalRMS.toLocaleString()} ÙˆØ§Ø· RMS</strong>.</p>
            <p>â€¢ Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­: <strong>${((totalRMS*1.6)/1000).toFixed(1)} kVA</strong>.</p>`;

        document.getElementById('boqTable').innerHTML = html;
        document.getElementById('reportImg').src = canvas.toDataURL();
        document.getElementById('reportPage').style.display = 'block';
    }

    window.onload = () => { fillSelectors(); draw(); };
</script>
</body>
</html>