<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Motivity AI Pro - Enterprise Audio Designer</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --motivity-red: #e60012; --dark-bg: #0d1117; --panel-bg: #161b22; --accent: #38bdf8; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; }
        body { background: var(--dark-bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* UI Components */
        .header { background: #1c2128; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--motivity-red); }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 380px; background: var(--panel-bg); padding: 15px; overflow-y: auto; border-left: 1px solid #30363d; }
        
        .control-box { background: #1c2128; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #30363d; }
        label { display: block; font-size: 11px; margin: 8px 0 4px; color: #8b949e; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; background: #0d1117; border: 1px solid #30363d; color: #fff; border-radius: 6px; margin-bottom: 5px; }
        
        .btn { cursor: pointer; border: none; border-radius: 6px; padding: 12px; font-weight: bold; width: 100%; margin-top: 10px; transition: 0.3s; }
        .btn-primary { background: var(--motivity-red); color: white; }
        .btn-accent { background: var(--accent); color: #000; }
        .btn:hover { opacity: 0.8; transform: translateY(-1px); }

        /* Canvas */
        .canvas-area { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1f26 0%, #0d1117 100%); }
        canvas { background: #050505; border: 1px solid #444; box-shadow: 0 0 40px rgba(0,0,0,0.5); cursor: move; }

        /* Report Styling */
        #reportOverlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:9999; padding:20px; overflow-y:auto; }
        .paper { background:#fff; color:#333; max-width:1000px; margin:auto; padding:40px; border-radius:8px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .report-header { display: flex; justify-content: space-between; border-bottom: 4px solid var(--motivity-red); padding-bottom: 15px; margin-bottom: 30px; }
        
        table { width:100%; border-collapse:collapse; margin: 25px 0; }
        th { background: #f4f4f4; text-align: right; padding: 12px; border: 1px solid #ddd; font-weight: 800; }
        td { padding: 12px; border: 1px solid #ddd; text-align: right; }
        
        .tech-note-box { padding: 20px; background: #f0faff; border-right: 6px solid var(--accent); border-radius: 4px; margin-top: 20px; }

        @media print {
            .no-print { display: none !important; }
            #reportOverlay { position: static; background: white; padding: 0; }
            .paper { box-shadow: none; border: none; width: 100%; padding: 0; }
            body { background: white; }
        }
    </style>
</head>
<body>

<div class="header no-print">
    <div style="font-weight:900; font-size:24px; letter-spacing: 1px;">MOTIVITY <span style="color:var(--motivity-red)">AI ANALYZER</span></div>
    <div style="display:flex; gap:20px; align-items: center;">
        <div style="font-size: 13px; color: #8b949e;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø±Ø©: <span id="topWatt" style="color:var(--accent); font-weight:bold;">0</span> W</div>
        <button class="btn btn-primary" style="margin:0; padding: 5px 15px;" onclick="location.reload()">ğŸ”„ ØªØµÙÙŠØ±</button>
    </div>
</div>

<div class="main-container no-print">
    <div class="sidebar">
        <div class="control-box">
            <h3>ğŸ“‚ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</h3>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©</label>
            <input type="text" id="projName" value="ÙÙ†Ø¯Ù‚ Ø§Ù„Ù…Ø§Ø³Ø© - Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</label>
            <select id="projectType">
                <option value="hotel">ÙÙ†Ø§Ø¯Ù‚ (Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù‡Ø§Ø¯Ø¦Ø© ÙˆÙ†Ø¯Ø§Ø¡)</option>
                <option value="hospital">Ù…Ø³ØªØ´ÙÙŠØ§Øª (ÙˆØ¶ÙˆØ­ Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…)</option>
                <option value="hall" selected>Ù‚Ø§Ø¹Ø§Øª (Ù‚ÙˆØ© SPL Ø¹Ø§Ù„ÙŠØ©)</option>
            </select>
            <div style="display:flex; gap:10px">
                <div><label>Ø§Ù„Ø·ÙˆÙ„ (Ù…)</label><input type="number" id="dimL" value="25" oninput="initSystem()"></div>
                <div><label>Ø§Ù„Ø¹Ø±Ø¶ (Ù…)</label><input type="number" id="dimW" value="15" oninput="initSystem()"></div>
            </div>
            <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø³Ù‚Ù (Ù…)</label>
            <input type="number" id="dimH" value="4" step="0.1" oninput="calculatePhysics()">
        </div>

        <div class="control-box">
            <h3>âš™ï¸ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ÙÙ†ÙŠØ©</h3>
            <label>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø§Ø¹Ø©</label>
            <select id="modelSelect" onchange="calculatePhysics()">
                <option value="CS606" data-full="6" data-half="3" data-low="1.5">CS606 (Max 6W)</option>
                <option value="CS612" data-full="12" data-half="6" data-low="3">CS612 (Max 12W)</option>
                <option value="CS620" data-full="20" data-half="10" data-low="5">CS620 (Max 20W)</option>
            </select>
            <label>Ù…ÙØªØ§Ø­ Ø§Ù„ÙˆØ§Ø· (Wattage Tap)</label>
            <select id="tapSelect" onchange="calculatePhysics()">
                <option value="full">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (100%)</option>
                <option value="half" selected>Ù†ØµÙ Ø§Ù„Ù‚Ø¯Ø±Ø© (50%)</option>
                <option value="low">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© (25%)</option>
            </select>
            <button class="btn btn-accent" onclick="smartDistribute()">âœ¨ ØªÙˆØ²ÙŠØ¹ Ø°ÙƒÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ</button>
            <button class="btn btn-primary" onclick="generateFullReport()">ğŸ“„ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„</button>
        </div>
        <p style="font-size:10px; color:#666; text-align:center;">* Ø§Ø³Ø­Ø¨ Ø§Ù„Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ø§Ù„Ù…Ø§ÙˆØ³ Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹</p>
    </div>

    <div class="canvas-area">
        <canvas id="audioCanvas"></canvas>
    </div>
</div>

<div id="reportOverlay">
    <div class="paper">
        <div class="report-header">
            <div>
                <h1 style="color:var(--motivity-red); margin:0">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</h1>
                <p>ØµØ§Ø¯Ø± Ø¹Ù† Ù…Ø­Ø±Ùƒ Motivity AI Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª</p>
            </div>
            <div style="text-align:left">
                <p id="repDate"></p>
                <p><b>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹:</b> MOT-ENG-2026</p>
            </div>
        </div>

        <h3 style="border-right: 5px solid var(--motivity-red); padding-right:10px; margin-bottom:15px;">1. Ù…Ø®Ø·Ø· Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ (Floor Plan)</h3>
        <div style="text-align:center; border:1px solid #ddd; padding:10px; background:#f9f9f9">
            <img id="mapImg" style="max-width:100%;">
        </div>

        <h3 style="border-right: 5px solid var(--motivity-red); padding-right:10px; margin: 25px 0 15px;">2. Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ (BOQ)</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¨Ù†Ø¯</th>
                    <th>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ/Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</th>
                </tr>
            </thead>
            <tbody id="boqTable"></tbody>
        </table>

        <div class="tech-note-box" id="repNotes"></div>

        <div class="no-print" style="margin-top:30px; display:flex; gap:10px">
            <button class="btn btn-primary" style="width:150px" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            <button class="btn btn-accent" style="width:100px" onclick="document.getElementById('reportOverlay').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('audioCanvas');
    const ctx = canvas.getContext('2d');
    let speakers = [];
    let isDragging = false;
    let selectedSpeaker = null;

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø£Ø¨Ø¹Ø§Ø¯
    function initSystem() {
        const L = parseFloat(document.getElementById('dimL').value);
        const W = parseFloat(document.getElementById('dimW').value);
        const container = canvas.parentElement;
        const scale = Math.min((container.clientWidth - 60) / L, (container.clientHeight - 60) / W);
        canvas.width = L * scale; canvas.height = W * scale;
        draw();
    }

    // Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø°ÙƒÙŠ
    function smartDistribute() {
        const L = parseFloat(document.getElementById('dimL').value);
        const W = parseFloat(document.getElementById('dimW').value);
        const H = parseFloat(document.getElementById('dimH').value);
        const spacing = (H - 1.5) * 1.8;
        const cols = Math.ceil(L / spacing);
        const rows = Math.ceil(W / spacing);
        speakers = [];
        for(let r=0; r<rows; r++) {
            for(let c=0; c<cols; c++) {
                speakers.push({ rx: (c + 0.5) / cols, ry: (r + 0.5) / rows });
            }
        }
        calculatePhysics();
    }

    // Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„Ù‚Ø¯Ø±Ø©
    function calculatePhysics() {
        const model = document.getElementById('modelSelect');
        const tap = document.getElementById('tapSelect').value;
        const opt = model.selectedOptions[0];
        let wattPerSpk = parseFloat(opt.dataset[tap]);
        
        const totalWatt = wattPerSpk * speakers.length;
        document.getElementById('topWatt').innerText = totalWatt.toFixed(1);
        draw();
    }

    // Ø±Ø³Ù… Ø§Ù„Ù„ÙˆØ­Ø©
    function draw() {
        ctx.fillStyle = "#050505";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        const scale = canvas.width / parseFloat(document.getElementById('dimL').value);
        const H = parseFloat(document.getElementById('dimH').value);
        const coverageRadius = (H - 1.5) * 1.5 * scale;

        speakers.forEach(s => {
            const x = s.rx * canvas.width;
            const y = s.ry * canvas.height;
            
            // Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙˆØª
            ctx.beginPath();
            ctx.arc(x, y, coverageRadius, 0, Math.PI*2);
            ctx.fillStyle = "rgba(56, 189, 248, 0.12)";
            ctx.fill();
            
            // Ø§Ù„Ø³Ù…Ø§Ø¹Ø©
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI*2);
            ctx.fillStyle = "var(--motivity-red)";
            ctx.fill();
            ctx.strokeStyle = "#fff";
            ctx.stroke();
        });
    }

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ø­Ø¨
    canvas.onmousedown = (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
        speakers.forEach(s => {
            if (Math.hypot(mx - s.rx*canvas.width, my - s.ry*canvas.height) < 15) {
                isDragging = true; selectedSpeaker = s;
            }
        });
    };
    canvas.onmousemove = (e) => {
        if (isDragging) {
            const rect = canvas.getBoundingClientRect();
            selectedSpeaker.rx = (e.clientX - rect.left) / canvas.width;
            selectedSpeaker.ry = (e.clientY - rect.top) / canvas.height;
            draw();
        }
    };
    canvas.onmouseup = () => { isDragging = false; calculatePhysics(); };

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    function generateFullReport() {
        const tap = document.getElementById('tapSelect').value;
        const watt = parseFloat(document.getElementById('modelSelect').selectedOptions[0].dataset[tap]);
        const totalWatt = watt * speakers.length;
        const type = document.getElementById('projectType').value;
        
        // Ù„ÙˆØ¬ÙŠÙƒ Ø§Ù„Ø£Ù…Ø¨Ù„ÙÙŠØ±Ø§Øª (ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©)
        let ampQty = 1;
        let ampModel = "MA-120-MP5P";
        if(totalWatt > 100 && totalWatt <= 220) ampModel = "MA-240-MP5P";
        else if(totalWatt > 220) {
            ampModel = "MA-240-MP5P";
            ampQty = Math.ceil(totalWatt / 210);
        }

        // ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        let typeAdvice = "";
        if(type === 'hotel') typeAdvice = "ØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ÙŠÙˆÙØ± Ø®Ù„ÙÙŠØ© ØµÙˆØªÙŠØ© Ù…ØªØ¬Ø§Ù†Ø³Ø© ÙÙŠ Ø§Ù„Ù…Ù…Ø±Ø§Øª Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙˆØ¶ÙˆØ­ Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦.";
        else if(type === 'hospital') typeAdvice = "ØªÙˆØ²ÙŠØ¹ Ù…ÙƒØ«Ù Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨ÙˆØ¶ÙˆØ­ Ù…Ø®Ø¨Ø±ÙŠ.";
        else typeAdvice = "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£Ù‚ØµÙ‰ Ù‚Ø¯Ø±Ø© ØªØºØ·ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ù‚ÙˆØ© Ø§Ù„ØµÙˆØª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª ÙˆØ§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø©.";

        document.getElementById('repDate').innerText = "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: " + new Date().toLocaleDateString('ar-EG');
        document.getElementById('mapImg').src = canvas.toDataURL();
        
        document.getElementById('boqTable').innerHTML = `
            <tr><td>Ø³Ù…Ø§Ø¹Ø© Ø³Ù‚Ù Ø¯Ø§Ø¦Ø±ÙŠØ©</td><td>Motivity ${document.getElementById('modelSelect').value}</td><td>${speakers.length}</td><td>Ø¥Ø¹Ø¯Ø§Ø¯: ${watt}W</td></tr>
            <tr><td>Ù…Ø¶Ø®Ù… ØµÙˆØª Ø±Ù‚Ù…ÙŠ</td><td>Motivity ${ampModel}</td><td>${ampQty}</td><td>ØªÙˆØ²ÙŠØ¹ Ø£Ø­Ù…Ø§Ù„</td></tr>
            <tr><td>ÙƒØ§Ø¨Ù„Ø§Øª ØµÙˆØª Ù…Ø¹Ø²ÙˆÙ„Ø©</td><td>2*1.5mm Fire Rated</td><td>${Math.round(speakers.length * 12)} Ù…</td><td>ØªÙ‚Ø¯ÙŠØ±ÙŠ</td></tr>
        `;

        document.getElementById('repNotes').innerHTML = `
            <strong>ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ©:</strong><br>
            â€¢ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±: <b>${document.getElementById('projectType').selectedOptions[0].innerText}</b>.<br>
            â€¢ ${typeAdvice}<br>
            â€¢ Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©: ÙŠØ¬Ø¨ Ø¶Ø¨Ø· Ù…ÙØªØ§Ø­ Ø§Ù„ÙˆØ§Ø· Ø®Ù„Ù ÙƒÙ„ Ø³Ù…Ø§Ø¹Ø© Ø¹Ù„Ù‰ <b>${watt}W</b> Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.<br>
            â€¢ ØªÙ… ØªÙˆÙÙŠØ± Ù‡Ø§Ù…Ø´ Ø£Ù…Ø§Ù† ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ Ø¨Ù†Ø³Ø¨Ø© 15% Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø£Ù…Ø¨Ù„ÙÙŠØ±Ø§Øª Ù…Ù† Ø§Ù„ØªÙ„Ù Ø§Ù„Ù†Ø§ØªØ¬ Ø¹Ù† Ø°Ø±ÙˆØ© Ø§Ù„Ø¥Ø´Ø§Ø±Ø©.
        `;

        document.getElementById('reportOverlay').style.display = 'block';
    }

    window.onload = () => { initSystem(); smartDistribute(); };
</script>
</body>
</html>