<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Motivity AI - Professional Enterprise Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root{ --motivity-red:#e60012; --tech-blue:#38bdf8; --monitor-green:#22c55e; --bg:#0d1117; }
        *{box-sizing:border-box; font-family:'Cairo', sans-serif; margin:0; padding:0}
        body{background:var(--bg); color:#fff; display:flex; height:100vh; overflow:hidden}
        .sidebar{width:480px; background:#161b22; padding:20px; overflow-y:auto; border-left:4px solid var(--motivity-red); flex-shrink:0}
        .box{background:#21262d; padding:15px; border-radius:10px; margin-bottom:12px; border:1px solid #30363d}
        h3{font-size:14px; color:var(--tech-blue); border-bottom:1px solid #444; padding-bottom:5px; margin-bottom:10px}
        label{font-size:11px; color:#8b949e; display:block; margin-top:8px}
        input, select{width:100%; padding:8px; background:#0d1117; color:#fff; border:1px solid #30363d; border-radius:6px; margin-top:4px}
        .main-view{flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000}
        canvas{background:#050505; border:2px solid #333; border-radius:12px; width:95%; max-height:75vh}
        .btn-group{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px}
        button{padding:14px; border:none; border-radius:8px; cursor:pointer; font-weight:700; transition:0.3s}
        .btn-smart{background:var(--tech-blue); color:#000}
        .btn-report{background:var(--motivity-red); color:#fff}
        
        #reportPage{display:none; position:fixed; inset:0; background:#fff; z-index:9999; color:#333; overflow-y:auto; padding:40px}
        .report-content{max-width:1000px; margin:auto; padding:30px; border:1px solid #ddd; background:#fff}
        .reasoning-box{background:#f0f7ff; border-right:8px solid var(--motivity-red); padding:20px; margin:20px 0; line-height:1.7}
        table{width:100%; border-collapse:collapse; margin:20px 0}
        th, td{border:1px solid #ddd; padding:12px; text-align:right}
        th{background:#f4f4f4; font-weight:900}
        .report-btns{display:flex; gap:10px; margin-bottom:20px}
        @media print { .no-print { display: none !important; } #reportPage { position: static; display: block; } }
    </style>
</head>
<body>

<div class="sidebar no-print">
    <h2 style="color:var(--motivity-red); text-align:center; margin-bottom:15px">MOTIVITY MASTER AI</h2>
    
    <div class="box">
        <h3>ğŸ“ Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
        <div style="display:flex; gap:10px">
            <div><label>Ø·ÙˆÙ„ Ø§Ù„Ø³Ø§Ø­Ø©</label><input type="number" id="l" value="120" oninput="draw()"></div>
            <div><label>Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø§Ø­Ø©</label><input type="number" id="w" value="70" oninput="draw()"></div>
        </div>
        <div style="display:flex; gap:10px">
            <div><label>Ø·ÙˆÙ„ Ø§Ù„Ù…Ø³Ø±Ø­</label><input type="number" id="sw" value="25" oninput="draw()"></div>
            <div><label>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø±Ø­</label><input type="number" id="sd" value="12" oninput="draw()"></div>
        </div>
        <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</label>
        <input type="number" id="crowd" value="5000" oninput="draw()">
    </div>

    <div class="box">
        <h3>ğŸ”Š Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ù„ØµØ¨</h3>
        <label>FOH Line Array</label>
        <select id="main_pa" onchange="draw()"></select>
        <input type="number" id="main_qty" value="16" oninput="draw()">
        
        <label>Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ¨ÙˆÙØ±</label>
        <select id="sub_pa" onchange="draw()"></select>
        <input type="number" id="sub_qty" value="12" oninput="draw()">
        
        <label>ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØµØ¨ÙˆÙØ±</label>
        <select id="sub_pos" onchange="draw()">
            <option value="sides">Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ (LR Stack)</option>
            <option value="front">Ø£Ù…Ø§Ù… Ø§Ù„Ù…Ø³Ø±Ø­ (Sub Array)</option>
        </select>
    </div>

    <div class="box">
        <h3>ğŸ›°ï¸ Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØªØºØ·ÙŠØ© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©</h3>
        <label>Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© 1 (15Ù…)</label>
        <select id="s1_pa" onchange="draw()"></select>
        <input type="number" id="s1_qty" value="4" oninput="draw()">
        
        <label>Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© 2 (40Ù…)</label>
        <select id="s2_pa" onchange="draw()"></select>
        <input type="number" id="s2_qty" value="4" oninput="draw()">
        
        <label>Ø³Ù…Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (65Ù…)</label>
        <select id="d_pa" onchange="draw()"></select>
        <input type="number" id="d_qty" value="6" oninput="draw()">
    </div>

    <div class="box">
        <h3>ğŸ›ï¸ Ø§Ù„Ù…ÙƒØ¨Ø±Ø§ØªØŒ Ø§Ù„Ù…ÙˆÙ†ÙŠØªÙˆØ± ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</h3>
        <label>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆÙ†ÙŠØªÙˆØ±</label>
        <select id="mon_pa" onchange="draw()"></select>
        <input type="number" id="mon_qty" value="8" oninput="draw()">
        
        <label>Ø§Ù„Ù…ÙƒØ¨Ø±Ø§Øª (Amplifiers)</label>
        <select id="amp_unit"></select>
        
        <label>Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ (DSP)</label>
        <select id="dsp_unit"></select>
    </div>

    <div class="btn-group">
        <button class="btn-smart" onclick="applySmart()">âœ¨ Ø§Ù‚ØªØ±Ø§Ø­ Ø°ÙƒÙŠ</button>
        <button class="btn-report" onclick="openReport()">ğŸ“„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙ†ÙŠ</button>
    </div>
</div>

<div class="main-view no-print">
    <canvas id="stageCanvas"></canvas>
</div>

<div id="reportPage">
    <div class="report-content">
        <div class="report-btns no-print">
            <button onclick="document.getElementById('reportPage').style.display='none'" style="background:#666; color:#fff">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
            <button onclick="window.print()" style="background:var(--monitor-green); color:#fff">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>
        <h1 style="color:var(--motivity-red); border-bottom:4px solid red; padding-bottom:10px">MOTIVITY TECHNICAL ANALYSIS</h1>
        <div class="reasoning-box" id="smartReasoning"></div>
        <table id="boqTable"></table>
        <img id="reportImg" style="width:100%; border:1px solid #333">
    </div>
</div>

<script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    const CATALOG = {
        // Line Array & Main
        "MLA212": { rms: 900, spl: 134 }, "MLA210": { rms: 700, spl: 137 }, 
        "MLHP312D": { rms: 900, spl: 134 }, "M10-LA": { rms: 700, spl: 136 },
        "T-24": { rms: 800, spl: 136 }, "MTL-152": { rms: 600, spl: 128 },
        "MTL-700 3G": { rms: 500, spl: 124 },
        // Subwoofers
        "DB-218 3G": { rms: 1400, spl: 136 }, "QX-218": { rms: 1400, spl: 135 },
        "MCC828SD": { rms: 1600, spl: 136 }, "B-30": { rms: 1200, spl: 135 }, "AT-18B": { rms: 800, spl: 130 },
        // Full Range & Fills
        "DB-25 3G": { rms: 1000, spl: 133 }, "DB-25 NW": { rms: 1000, spl: 133 },
        "HD315A": { rms: 1000, spl: 133 }, "HD312A": { rms: 1000, spl: 131 },
        "AT-15": { rms: 500, spl: 127 }, "AT-12": { rms: 450, spl: 125 }, "AT-10": { rms: 350, spl: 123 },
        "DB-15M 3G": { rms: 500, spl: 124 },
        // Amplifiers & DSP
        "MA-1500": { spec: "2x1500W @ 8Î©" }, "MA-1000": { spec: "2x1000W @ 8Î©" },
        "MA-800": { spec: "2x800W @ 8Î©" }, "D11.4": { spec: "4x1100W Digital" },
        "DP48": { spec: "4 In / 8 Out DSP" }
    };

    function fillSelectors() {
        const specs = {
            main_pa: ["MLA212", "MLA210", "MLHP312D", "M10-LA", "T-24"],
            sub_pa: ["DB-218 3G", "QX-218", "MCC828SD", "B-30", "AT-18B"],
            s1_pa: ["DB-25 3G", "DB-25 NW", "HD315A", "AT-15"],
            s2_pa: ["MTL-152", "MTL-700 3G", "HD312A", "AT-12"],
            d_pa: ["AT-12", "AT-10", "MTL-700 3G"],
            mon_pa: ["DB-15M 3G", "AT-12", "AT-10"],
            amp_unit: ["MA-1500", "MA-1000", "MA-800", "D11.4"],
            dsp_unit: ["DP48"]
        };
        for(let id in specs) {
            const el = document.getElementById(id);
            specs[id].forEach(m => el.add(new Option(m, m)));
        }
    }

    const canvas = document.getElementById('stageCanvas');
    const ctx = canvas.getContext('2d');

    function draw() {
        const L = parseFloat(document.getElementById('l').value);
        const W = parseFloat(document.getElementById('w').value);
        const sw = parseFloat(document.getElementById('sw').value);
        const sd = parseFloat(document.getElementById('sd').value);
        const monQty = parseInt(document.getElementById('mon_qty').value);
        const subPos = document.getElementById('sub_pos').value;
        const subQty = parseInt(document.getElementById('sub_qty').value);

        canvas.width = 1200; canvas.height = 800;
        const scale = Math.min(canvas.width/L, canvas.height/W) * 0.8;
        const oX = (canvas.width - L*scale)/2;
        const oY = (canvas.height - W*scale)/2;

        ctx.clearRect(0,0,1200,800);
        ctx.fillStyle = "#0a0a0a"; ctx.fillRect(oX, oY, L*scale, W*scale);

        // Ø§Ù„Ù…Ø³Ø±Ø­
        const sW = sw * scale; const sD = sd * scale;
        const sX = oX + (L*scale - sW)/2;
        ctx.fillStyle = "#161b22"; ctx.fillRect(sX, oY, sW, sD);
        ctx.strokeStyle = "#e60012"; ctx.strokeRect(sX, oY, sW, sD);

        // Ø§Ù„Ù…ÙˆÙ†ÙŠØªÙˆØ±Ø§Øª Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡
        ctx.fillStyle = "#22c55e";
        const mSpc = sW / (monQty + 1);
        for(let i=1; i<=monQty; i++) {
            ctx.beginPath(); ctx.moveTo(sX + i*mSpc - 8, oY + sD - 5);
            ctx.lineTo(sX + i*mSpc + 8, oY + sD - 5); ctx.lineTo(sX + i*mSpc, oY + sD - 18);
            ctx.fill();
        }

        // FOH
        ctx.fillStyle = "#38bdf8"; ctx.fillRect(sX-30, oY, 20, 60); ctx.fillRect(sX+sW+10, oY, 20, 60);

        // Ø§Ù„ØµØ¨ÙˆÙØ± Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ
        ctx.fillStyle = "#555";
        if(subPos === "sides") {
            for(let i=0; i<subQty/2; i++) { ctx.fillRect(sX-60, oY + i*20, 20, 15); ctx.fillRect(sX+sW+40, oY + i*20, 20, 15); }
        } else {
            const spc = sW / subQty; for(let i=0; i<subQty; i++) ctx.fillRect(sX + i*spc, oY+sD+5, 18, 12);
        }

        // Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù„ÙˆÙ†Ø© Ù„Ù„ØªØºØ·ÙŠØ©
        const dEx = (dist, qty, col) => {
            const py = oY + (dist * scale);
            ctx.fillStyle = col;
            for(let i=0; i<qty/2; i++) { ctx.fillRect(oX+15, py+i*25, 15, 15); ctx.fillRect(oX+L*scale-30, py+i*25, 15, 15); }
        };
        dEx(15, document.getElementById('s1_qty').value, "#facc15");
        dEx(40, document.getElementById('s2_qty').value, "#f59e0b");
        dEx(65, document.getElementById('d_qty').value, "#a855f7");
    }

    function applySmart() {
        const cr = parseInt(document.getElementById('crowd').value);
        document.getElementById('main_qty').value = Math.max(12, Math.ceil(cr / 400));
        document.getElementById('sub_qty').value = Math.max(8, Math.ceil(document.getElementById('main_qty').value * 0.8));
        draw();
    }

    function openReport() {
        const cr = parseInt(document.getElementById('crowd').value);
        const mq = document.getElementById('main_pa').value;
        const mqty = parseInt(document.getElementById('main_qty').value);
        const rms = CATALOG[mq].rms || 0;
        
        let reasoning = `<h3>ğŸ“ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ù„Ù„Ù†Ø¸Ø§Ù…:</h3>`;
        reasoning += `<p>â€¢ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (${cr} Ø´Ø®Øµ)ØŒ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…ØµÙÙˆÙØ© <strong>${mq}</strong> Ø¨Ø¹Ø¯Ø¯ ÙƒØ¨Ø§Ø¦Ù† Ø¥Ø¬Ù…Ø§Ù„ÙŠ ${mqty}ØŒ Ù…Ù…Ø§ ÙŠØ¹Ø·ÙŠ Ø¶ØºØ·Ø§Ù‹ ØµÙˆØªÙŠØ§Ù‹ Ù…ØªÙˆØ§Ø²Ù†Ø§Ù‹.</p>`;
        reasoning += `<p>â€¢ ØªÙ… Ø¯Ù…Ø¬ Ø³Ù…Ø§Ø¹Ø§Øª <strong>MTL-700 3G</strong> Ùˆ <strong>MTL-152</strong> ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØ§Ù„Ø¹Ù…Ù‚ Ù„Ø¶Ù…Ø§Ù† ÙˆØ¶ÙˆØ­ Ù…Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙˆØª Ø§Ù„Ø¨Ø´Ø±ÙŠØ© (Intelligibility) ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ØªÙŠ ÙŠØ¶Ø¹Ù ÙÙŠÙ‡Ø§ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.</p>`;
        reasoning += `<p>â€¢ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØ¨Ø±Ø§Øª Ø³Ù„Ø³Ù„Ø© <strong>MA</strong> (${document.getElementById('amp_unit').value}) ÙŠÙˆÙØ± Ø·Ø§Ù‚Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (Headroom) ØªÙ…Ù†Ø¹ Ø§Ù„ØªØ´ÙˆÙŠÙ‡ (Clipping) Ø¹Ù†Ø¯ Ø§Ù„Ø°Ø±ÙˆØ©.</p>`;
        
        document.getElementById('smartReasoning').innerHTML = reasoning;

        let html = "<tr><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>";
        const keys = [["FOH", "main_pa", "main_qty"], ["Sub", "sub_pa", "sub_qty"], ["Side 1", "s1_pa", "s1_qty"], ["Side 2", "s2_pa", "s2_qty"], ["Delay", "d_pa", "d_qty"], ["Monitor", "mon_pa", "mon_qty"], ["Amp", "amp_unit", "1"]];
        keys.forEach(k => {
            const m = document.getElementById(k[1]).value;
            const q = k[2] === "1" ? "Ø­Ø³Ø¨ Ø§Ù„Ø­Ù…Ù„" : document.getElementById(k[2]).value;
            html += `<tr><td>${k[0]}</td><td>${m}</td><td>${q}</td><td>${CATALOG[m].rms ? CATALOG[m].rms+'W' : CATALOG[m].spec}</td></tr>`;
        });
        
        document.getElementById('boqTable').innerHTML = html;
        document.getElementById('reportImg').src = canvas.toDataURL();
        document.getElementById('reportPage').style.display = 'block';
    }

    window.onload = () => { fillSelectors(); draw(); };
</script>
</body>
</html>