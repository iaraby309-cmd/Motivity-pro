<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Motivity Master AI - Outdoor Spaces 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
:root{
  --motivity-red:#e60012;
  --tech-blue:#38bdf8;
  --sub-yellow:#e5c07b;
  --monitor-green:#22c55e;
  --bg:#0d1117;
}
*{box-sizing:border-box; font-family:'Cairo', sans-serif; margin:0; padding:0}
body{background:var(--bg); color:#fff; display:flex; height:100vh; overflow:hidden}

.sidebar{width:450px; background:#161b22; padding:20px; overflow-y:auto; border-right:4px solid var(--motivity-red); flex-shrink:0}
.box{background:#21262d; padding:15px; border-radius:10px; margin-bottom:12px; border:1px solid #30363d}
h3{font-size:14px; color:var(--tech-blue); margin-bottom:8px; border-bottom:1px solid #444; padding-bottom:5px; text-transform:uppercase}
label{font-size:12px; color:#8b949e; display:block; margin-top:8px}
input, select{width:100%; padding:8px; background:#0d1117; color:#fff; border:1px solid #30363d; border-radius:6px; margin-top:4px; font-size:12px}

.btn-smart { background: linear-gradient(135deg, var(--motivity-red), #99000d); color:#fff; font-weight:900; padding:15px; border:none; border-radius:8px; cursor:pointer; width:100%; margin-bottom:10px; transition:0.3s}
.btn-reset { background: #30363d; color: #f85149; border: 1px solid #f85149; padding: 10px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; margin-bottom: 10px;}
.btn-save { background: #22c55e; color:#000; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold; width:100%; margin-bottom:10px;}
.btn-pdf { background: #38bdf8; color:#000; border:none; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold; width:100%; margin-bottom:10px;}
.tool-btn { background:#0d1117; color:#fff; border:1px solid #444; padding:8px; font-size:11px; cursor:pointer; border-radius:6px; width:48%; margin-top:5px}
.tool-btn.active { background:var(--tech-blue); color:#000; font-weight:bold}

.main-view { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#000; position:relative}
canvas { background:#050505; border:2px solid #333; border-radius:12px; width:95%; max-height:75vh; cursor:crosshair}

.beam-controls { position:absolute; bottom:20px; background:rgba(22, 27, 34, 0.95); padding:15px; border-radius:15px; border:1px solid var(--tech-blue); width:85%; display:flex; gap:20px; align-items:center}

#reportPage { display:none; position:fixed; inset:0; background:#fff; z-index:9999; color:#333; overflow-y:auto; padding:40px}
.report-content { max-width:1200px; margin:auto; border:2px solid #ddd; padding:30px; border-top: 20px solid var(--motivity-red); background:#fff;}
.analysis-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
.analysis-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee; text-align: center; }
.analysis-card h4 { color: var(--motivity-red); font-size: 14px; margin-bottom: 5px; }
table { width:100%; border-collapse:collapse; margin:20px 0}
th, td { border:1px solid #ddd; padding:12px; text-align:left}
th { background: #f4f4f4; color: #333; font-weight: 900; }
@media print { .no-print { display: none !important; } }
</style>
</head>
<body>

<div class="sidebar no-print">
<h2 style="color:var(--motivity-red); text-align:center; font-weight:900">MOTIVITY MASTER AI - Outdoor</h2>

<div class="box">
<h3>üìè Outdoor Area Settings</h3>
<div style="display:flex; gap:10px">
<div><label>Length (m)</label><input type="number" id="out_l" value="120" oninput="draw()"></div>
<div><label>Width (m)</label><input type="number" id="out_w" value="70" oninput="draw()"></div>
</div>
<div style="display:flex; gap:10px">
<div><label>Stage Width (m)</label><input type="number" id="stage_w" value="25" oninput="draw()"></div>
<div><label>Stage Depth (m)</label><input type="number" id="stage_d" value="12" oninput="draw()"></div>
</div>
<div><label>Floor Type</label>
<select id="floor_type" onchange="draw()">
<option value="grass">Natural Grass</option>
<option value="concrete">Concrete</option>
<option value="asphalt">Asphalt</option>
</select>
</div>
<div><label>Expected Audience</label><input type="number" id="crowd" value="5000" oninput="draw()"></div>
</div>

<div class="box">
<h3>üîä Official 2026 Catalog</h3>
<label>1. Main Systems & Side Fills</label>
<select id="sel_main">
<optgroup label="Point Source">
<option value="DB-25 NW" data-spl="133" data-h="100" data-v="70">DB-25 NW (1000W / 133dB)</option>
<option value="DB-25 3G" data-spl="130" data-h="100" data-v="60">DB-25 3G (1000W / 130dB)</option>
<option value="MTL-700 3G" data-spl="126" data-h="90" data-v="60">MTL-700 3G (500W)</option>
</optgroup>
<optgroup label="Line Array Series">
<option value="MLA212" data-spl="138" data-h="90" data-v="10">MLA212 (Dual 12" - 900W)</option>
<option value="MLA210" data-spl="135" data-h="90" data-v="10">MLA210 (Dual 10" - 700W)</option>
<option value="M10-LA" data-spl="132" data-h="100" data-v="10">M10-LA (Compact 700W)</option>
<option value="MLA208" data-spl="130" data-h="100" data-v="10">MLA208 (Dual 8")</option>
</optgroup>
<optgroup label="Active Series">
<option value="HD315A" data-spl="131" data-h="90" data-v="60">HD315A (1000W Active)</option>
<option value="HD312A" data-spl="128" data-h="90" data-v="60">HD312A (1000W Active)</option>
</optgroup>
</select>

<label>2. Subs & Monitors</label>
<select id="sel_extra">
<option value="DB-218 3G">DB-218 3G (Dual 18" - 1400W)</option>
<option value="QX-218">QX-218 (Dual 18" Touring)</option>
<option value="HD-SUB-18A">HD-SUB-18A (Active Sub)</option>
<option value="DB-15M 3G">DB-15M 3G (Stage Monitor)</option>
<option value="MTL-152">MTL-152 (KTV/Monitor)</option>
</select>

<div style="display:flex; justify-content:space-between; margin-top:10px">
<button class="tool-btn active" id="btn_main" onclick="setMode('main')">Add Main</button>
<button class="tool-btn" id="btn_sub" onclick="setMode('sub')">Add Sub/Monitor</button>
</div>
</div>

<button class="btn-smart" onclick="applySmartLayout()">üöÄ AI SMART LAYOUT</button>
<button class="btn-smart" style="background:var(--tech-blue); color:#000" onclick="generateReport()">üìÑ GENERATE ENGINEERING REPORT</button>
<button class="btn-pdf" onclick="savePDFReport()">üì• SAVE AS PDF</button>
<button class="btn-save" onclick="saveReport()">üñºÔ∏è SAVE MAP AS PNG</button>
<button class="btn-reset" onclick="resetCanvas()">üîÑ RESET CANVAS</button>

</div>

<div class="main-view no-print">
<canvas id="mainCanvas"></canvas>
<div class="beam-controls">
<div style="flex:1">
<label style="color:var(--tech-blue); margin:0">Coverage Orientation</label>
<input type="range" id="beam_angle" min="0" max="360" value="90" oninput="updateSelected()">
</div>
<div style="flex:1">
<label style="color:var(--tech-blue); margin:0">Effective Range</label>
<input type="range" id="beam_range" min="50" max="850" value="400" oninput="updateSelected()">
</div>
<div id="sel_name" style="font-weight:bold; font-size:12px; width:130px; color:var(--motivity-red)">-- Select Product --</div>
</div>
</div>

<div id="reportPage">
<div class="report-content" id="report-to-pdf">
<button onclick="document.getElementById('reportPage').style.display='none'" class="no-print" style="padding:5px 15px; cursor:pointer; margin-bottom:10px">‚ùå Close Preview</button>
<h1 style="color:var(--motivity-red); text-align:center; font-weight:900">Acoustic Engineering Analysis Report - 2026</h1>
<div class="analysis-grid">
<div class="analysis-card"><h4>üîä Max Pressure (SPL)</h4><p id="rep_spl_val">-- dB</p></div>
<div class="analysis-card"><h4>‚è≥ Latency (Delay)</h4><p id="rep_delay_val">-- ms</p></div>
<div class="analysis-card"><h4>üìê Dispersion (H/V)</h4><p id="rep_angle_val">-- / --</p></div>
</div>
<div id="boqSection"></div>
<h3 style="border-bottom: 2px solid #eee; margin-top: 20px;">üó∫Ô∏è Acoustic Simulation Map</h3>
<img id="reportImg" style="width:100%; background:#050505; border-radius:15px; margin-top:15px">
</div>
</div>

<script>
const canvas=document.getElementById('mainCanvas');
const ctx=canvas.getContext('2d');
let points=[],currentMode='main',selectedPoint=null;

function setMode(m){currentMode=m;document.querySelectorAll('.tool-btn').forEach(b=>b.classList.remove('active'));document.getElementById('btn_'+m).classList.add('active');}
function resetCanvas(){points=[]; selectedPoint=null; document.getElementById('sel_name').innerText="-- Select Product --"; draw();}
function updateSelected(){if(selectedPoint){selectedPoint.angle=parseInt(document.getElementById('beam_angle').value);selectedPoint.range=parseInt(document.getElementById('beam_range').value); draw();}}

function applySmartLayout(){
points=[];
const L=+out_l.value, W=+out_w.value, sW=+stage_w.value, sD=+stage_d.value;
const scale=Math.min(1100/L,600/W)*0.8;
const oX=(1100-L*scale)/2,oY=(600-W*scale)/2;
const stX=oX+(L*scale-sW*scale)/2;
const profile={type:"concert", load:L>60?"heavy":"medium"};

const elementsPerSide=Math.max(4, Math.ceil(L/10)); const finalElements=elementsPerSide%2===0?elementsPerSide:elementsPerSide+1;
points.push({x:stX-30,y:oY+(sD*scale/2),type:'main',name:'Line Array L',angle:90+10,range:L*scale*0.9,spl:138,hAngle:90,vAngle:10,isLineArray:true,elements:finalElements/2});
points.push({x:stX+(sW*scale)+30,y:oY+(sD*scale/2),type:'main',name:'Line Array R',angle:90-10,range:L*scale*0.9,spl:138,hAngle:90,vAngle:10,isLineArray:true,elements:finalElements/2});

const subCount=profile.load==="heavy"?6:4;
for(let i=0;i<subCount;i++){points.push({x:stX+(sW*scale/(subCount-1))*i,y:oY+(sD*scale)+25,type:'sub',name:'Subwoofer',angle:90,range:200});}

const sideCountPerSide = profile.load === "heavy" ? 3 : 2; 
for (let i = 0; i < sideCountPerSide; i++) {
    const yPos = oY + (W * scale / (sideCountPerSide + 1)) * (i + 1);
    points.push({x: oX + 15, y: yPos, type: 'side', name: 'Side Fill (L)', angle: 0, range: (W * scale) * 0.4, hAngle: 90});
    points.push({x: oX + (L * scale) - 15, y: yPos, type: 'side', name: 'Side Fill (R)', angle: 180, range: (W * scale) * 0.4, hAngle: 90});
}

let monitorCount=sW>16?8:(sW>10?6:4);
for(let i=0;i<monitorCount;i++){points.push({x:stX+(sW*scale/(monitorCount-1))*i,y:oY+(sD*scale)-10,type:'sub',name:'Stage Monitor',angle:270,range:120});}
draw();
}

function draw(){
const L=+out_l.value, W=+out_w.value, sW=+stage_w.value, sD=+stage_d.value;
canvas.width=1100; canvas.height=600;
const scale=Math.min(canvas.width/L,canvas.height/W)*0.8;
const oX=(canvas.width-L*scale)/2,oY=(canvas.height-W*scale)/2;
ctx.clearRect(0,0,canvas.width,canvas.height);

const floor=document.getElementById('floor_type').value;
ctx.fillStyle=floor==="grass"?"#145214":floor==="concrete"?"#555":"#333";
ctx.fillRect(oX,oY,L*scale,W*scale);
ctx.strokeStyle="#333"; ctx.lineWidth=4; ctx.strokeRect(oX,oY,L*scale,W*scale);

const stX=oX+(L*scale-sW*scale)/2;
ctx.fillStyle="rgba(230,0,18,0.1)"; ctx.fillRect(stX,oY,sW*scale,sD*scale);
ctx.strokeStyle="#e60012"; ctx.strokeRect(stX,oY,sW*scale,sD*scale);

points.forEach(p=>{
const angleRad=p.angle*(Math.PI/180);
const spread=(p.hAngle||100)*(Math.PI/180);
const grad=ctx.createRadialGradient(p.x,p.y,5,p.x,p.y,p.range);
if(p.type==='main'){grad.addColorStop(0,'rgba(56,189,248,0.6)');grad.addColorStop(1,'rgba(56,189,248,0.05)');}
else if(p.name.includes("Sub")){grad.addColorStop(0,'rgba(229,192,123,0.6)');grad.addColorStop(1,'transparent');}
else{grad.addColorStop(0,'rgba(34,197,94,0.6)');grad.addColorStop(1,'transparent');}
ctx.fillStyle=grad;
ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.arc(p.x,p.y,p.range,angleRad-spread/2,angleRad+spread/2); ctx.closePath(); ctx.fill();
if(p.isLineArray) drawLineArrayStack(p); else drawRegularSpeaker(p);
});
}

function drawRegularSpeaker(p){
ctx.beginPath(); ctx.arc(p.x,p.y,8,0,Math.PI*2);
ctx.fillStyle=(p===selectedPoint)?"#fff":(p.type==='main'?'#38bdf8':p.name.includes("Sub")?'#e5c07b':'#22c55e');
ctx.fill(); ctx.strokeStyle="#fff"; ctx.stroke();
ctx.fillStyle="#fff"; ctx.font="bold 10px Cairo"; ctx.fillText(p.name,p.x+12,p.y+3);
}

function drawLineArrayStack(p){
const unitWidth=10, unitHeight=6, spacing=2;
const angleRad=p.angle*Math.PI/180;
ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(angleRad-Math.PI/2);
for(let i=0;i<p.elements;i++){ctx.fillStyle="rgba(56,189,248,0.9)";ctx.fillRect(-unitWidth/2,-(i*(unitHeight+spacing)),unitWidth,unitHeight);ctx.strokeStyle="#fff";ctx.strokeRect(-unitWidth/2,-(i*(unitHeight+spacing)),unitWidth,unitHeight);}
ctx.restore(); ctx.fillStyle="#38bdf8"; ctx.font="bold 11px Cairo"; ctx.fillText(`Line Array (${p.elements} units)`,p.x+14,p.y-(p.elements*4));
}

canvas.addEventListener('mousedown',e=>{
const rect=canvas.getBoundingClientRect();
const x=(e.clientX-rect.left)*(canvas.width/rect.width);
const y=(e.clientY-rect.top)*(canvas.height/rect.height);
const clicked=points.find(p=>Math.hypot(p.x-x,p.y-y)<15);
if(clicked){selectedPoint=clicked; document.getElementById('sel_name').innerText=selectedPoint.name; document.getElementById('beam_angle').value=selectedPoint.angle; document.getElementById('beam_range').value=selectedPoint.range;}
else{
const sel=document.getElementById(currentMode==='main'?'sel_main':'sel_extra');
const opt=sel.options[sel.selectedIndex];
points.push({x,y,type:currentMode,name:sel.value,angle:90,range:400,spl:opt.dataset.spl||120,hAngle:opt.dataset.h||100,vAngle:opt.dataset.v||70});
selectedPoint=points[points.length-1];
document.getElementById('beam_angle').value=90;
document.getElementById('beam_range').value=400;
}
draw();
});

function buildEngineeringDecision(){
const L=+out_l.value,W=+out_w.value,sW=+stage_w.value,crowd=+document.getElementById('crowd').value;
const hasLineArray=points.some(p=>p.isLineArray);
const mainCount=points.filter(p=>p.type==='main').length;
const subCount=points.filter(p=>p.type==='sub'&&p.name.includes("Sub")).length;
const monitorCount=points.filter(p=>p.name.includes("Monitor")||p.name.includes("Stage")).length;
return{
eventText:`System designed for an outdoor area of ${L}m √ó ${W}m accommodating ~${crowd} pax.`,
systemText:hasLineArray?"Line Array architecture selected for balanced coverage over large distances.":"Point Source architecture selected for distributed open-air sound reinforcement.",
quantityText:hasLineArray?`Deployed ${mainCount} Line Array clusters for long-throw efficiency.`:`Deployed ${mainCount} full-range cabinets for localized coverage.`,
subText:`${subCount} high-power Subwoofers integrated for low-frequency extension.`,
monitorText:`${monitorCount} Stage Monitors allocated for performers' foldback.`,
alternativeText:hasLineArray?"Point Source could be used as a secondary option with delay zones.":"Line Array could be an alternative to reduce cabinet count while increasing SPL overhead."
};
}

function generateReport(){
const decision=buildEngineeringDecision();
const counts={}; points.forEach(p=>counts[p.name]=(counts[p.name]||0)+1);
document.getElementById('boqSection').innerHTML=`
<div style="background:#f0f7ff; padding:15px; border-radius:10px; margin-bottom:20px; border-left:5px solid var(--tech-blue)">
<h3>üìò Engineering Decision Summary</h3>
<p>${decision.eventText}</p>
<p><b>System Architecture:</b> ${decision.systemText}</p>
<p><b>Quantity Justification:</b> ${decision.quantityText}</p>
<p><b>LF Design:</b> ${decision.subText}</p>
<p><b>Stage Monitoring:</b> ${decision.monitorText}</p>
<p><b>Alternative Scenario:</b> ${decision.alternativeText}</p>
</div>
<h3>üì¶ Bill of Quantities (BOQ)</h3>
<table><tr><th>Product Name</th><th>Quantity</th></tr>`+
Object.entries(counts).map(([n,c])=>`<tr><td><b>${n}</b></td><td>${c} Unit(s)</td></tr>`).join('')+
`</table>`;
document.getElementById('reportImg').src=canvas.toDataURL();
document.getElementById('reportPage').style.display='block';
}

function saveReport(){
    const link = document.createElement('a');
    link.href = document.getElementById('reportImg').src;
    link.download = 'Motivity_Report_Outdoor_Map.png';
    link.click();
}

function savePDFReport(){
    generateReport();
    const element = document.getElementById('report-to-pdf');
    const opt = {
        margin: 10,
        filename: 'Motivity_Engineering_Report_2026.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    const closeBtn = element.querySelector('.no-print');
    if(closeBtn) closeBtn.style.display = 'none';
    html2pdf().set(opt).from(element).save().then(() => {
        if(closeBtn) closeBtn.style.display = 'block';
    });
}
window.onload=draw;
</script>
</body>
</html>
